<!DOCTYPE html>
<html>

<head>
  <title>Display Platform Name</title>
</head>

<body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
    import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-storage.js";
    //get the receipt name from parameters
    const urlParams = new URLSearchParams(window.location.search);
    const fileName = urlParams.get('fileName');
    const url = "https://storage.googleapis.com/e-receipt-b118e.appspot.com/";

    // Construct the new URL with the data
    const redirectURL = `intent://com.example.e_receipt_app?fileName=${url}${fileName}#Intent;scheme=https;package=com.example.e_receipt_app;end`;

    /*     // Display the platform name
        const displayElement = document.createElement('div');
        displayElement.textContent = 'Platform: ' + platformName;
        document.body.appendChild(displayElement); */

    //Checks if os is android
    const platformName = navigator.platform;
    const isAndroid = /Android/.test(navigator.userAgent);

    //display isAndroid
    const displayElement = document.createElement('header');
    displayElement.textContent = 'IsAndroid: ' + isAndroid;
    document.body.appendChild(displayElement);

    if (isAndroid)
    {
      // Redirect the user to app if on android
      window.location.replace(redirectURL);
    }
    else
    {
      // Download the json receipt
      /* fetch(`${url}${fileName}`)
        .then(response =>
        {
          if (!response.ok)
          {
            throw new Error('Network response was not ok');
          }
          return response.json(); // Parse response as JSON
        })
        .then(data =>
        {
          // Display the JSON data in a readable format
          const displayElement = document.createElement('receipt');
          displayElement.textContent = JSON.stringify(data, null, 2);;
          document.body.appendChild(displayElement);
        })
        .catch(error =>
        {
          console.error('Error loading JSON:', error)
        }); */


      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCKO0FYxLLu5dZP7LppGskYZtYM7GyeTMY",
        authDomain: "e-receipt-b118e.firebaseapp.com",
        projectId: "e-receipt-b118e",
        storageBucket: "e-receipt-b118e.appspot.com",
        messagingSenderId: "165994310914",
        appId: "1:165994310914:web:03fe218bb79819d794661b",
        measurementId: "G-YWZ517YGVN"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const storage = getStorage(app);
      const storageRef = ref(storage, `Receipts/${fileName}`);

      storageRef.getDownloadURL()
        .then((url) =>
        {
          // Use the URL to fetch the file or display it in an image element
          fetch(url)
            .then(response => response.blob())
            .then(blob =>
            {
              // Create an <img> element to display the file
              const img = document.createElement('img');
              img.src = URL.createObjectURL(blob);
              document.body.appendChild(img);
            })
            .catch(error => console.error('Error fetching file:', error));
        })
        .catch(error => console.error('Error getting download URL:', error));
    }
  </script>
</body>

</html>